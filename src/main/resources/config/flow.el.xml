<?xml version="1.0" encoding="UTF-8"?>
<flow>

    <!--<chain name="processNodeHandle">
        SWITCH(chooseStage).to(
            THEN(
                SWITCH(chooseNode).to(
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("next"),statusBusinessHandle.tag("next")
                            ).id("FINISH")
                        )
                    ).id("RELEASE_DOC"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("next"),statusBusinessHandle.tag("next")
                            ).id("FINISH"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle
                            ).id("ABNORMAL"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle
                            ).id("REST")
                        )
                    ).id("AUDIT")
                )
            ).id("POST"),
            b
        );
    </chain>-->

    <chain name="bidderProcessNodeHandle">
        SWITCH(chooseStage).to(
            THEN(
                SWITCH(chooseNode).to(
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:AUDIT|status:OPEN"),statusBusinessHandle.tag("node:AUDIT|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("RELEASE_DOC"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:RELEASE_ANNOUNCE|status:OPEN"),statusBusinessHandle.tag("node:RELEASE_ANNOUNCE|status:OPEN")
                            ).id("FINISH"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle
                            ).id("ABNORMAL"),
                            THEN(
                                /** 当前节点重置为 【开启】 **/
                                statusNodeHandle,statusBusinessHandle
                            ).id("REST"),
                            THEN(
                                restStatusNodeHandle.tag("node:AUDIT|status:WAITING"),
                                restStatusBusinessHandle.tag("node:AUDIT|status:WAITING"),
                                restStatusNodeHandle.tag("node:RELEASE_DOC|status:OPEN"),
                                restStatusBusinessHandle.tag("node:RELEASE_DOC|status:OPEN")
                            ).id("ABNORMAL_NODE_REST"),
                            exceptionEnd
                        )
                    ).id("AUDIT"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle,
                                stageHandle.tag("stage:QUOTE|status:OPEN"),stageBusinessHandle.tag("stage:QUOTE|status:OPEN"),
                                statusNodeHandle.tag("node:REGISTER|status:OPEN|stage:QUOTE"),statusBusinessHandle.tag("node:REGISTER|status:OPEN|stage:QUOTE")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("RELEASE_ANNOUNCE"),
                    exceptionEnd
                )
            ).id("POST"),
            THEN(
                SWITCH(chooseNode).to(
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:QUOTE|status:OPEN"),statusBusinessHandle.tag("node:QUOTE|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("REGISTER"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle,
                                /**查找所有已报名未投标的【投标方】，将其流程状态更改为 【投标 异常】 【未投标-未中标 开启】**/
                                FOR(findTenderUnQuote).DO(
                                    THEN(
                                        tenderUnQuoteHandle.tag("node:QUOTE|status:ABNORMAL"),
                                        tenderUnQuoteBusinessHandle.tag("node:QUOTE|status:ABNORMAL"),
                                        tenderUnQuoteStageHandle.tag("stage:QUOTE|status:FINISH"),
                                        tenderUnQuoteStageBusinessHandle.tag("stage:QUOTE|status:FINISH"),

                                        tenderUnQuoteStageHandle.tag("stage:NOT_WIN|status:OPEN"),
                                        tenderUnQuoteStageBusinessHandle.tag("stage:NOT_WIN|status:OPEN"),
                                        tenderUnQuoteHandle.tag("node:REGISTER_NOT_WIN|status:OPEN"),
                                        tenderUnQuoteBusinessHandle.tag("node:REGISTER_NOT_WIN|status:OPEN")
                                    )
                                ),
                                stageHandle.tag("stage:CALIBRATION|status:OPEN"),stageBusinessHandle.tag("stage:CALIBRATION|status:OPEN"),
                                statusNodeHandle.tag("node:DETERMINE_WINNER|status:OPEN"),statusBusinessHandle.tag("node:DETERMINE_WINNER|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("QUOTE"),
                    exceptionEnd
                )
            ).id("QUOTE"),
            THEN(
                SWITCH(chooseNode).to(
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:AUDIT|status:OPEN"),statusBusinessHandle.tag("node:AUDIT|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("DETERMINE_WINNER"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:RELEASE_CALIBRATION|status:OPEN"),statusBusinessHandle.tag("node:RELEASE_CALIBRATION|status:OPEN")
                            ).id("FINISH"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle
                            ).id("ABNORMAL"),
                            THEN(
                                /** 当前节点重置为 【开启】 **/
                                statusNodeHandle,statusBusinessHandle
                            ).id("REST"),
                            THEN(
                                restStatusNodeHandle.tag("node:AUDIT|status:WAITING"),
                                restStatusBusinessHandle.tag("node:AUDIT|status:WAITING"),
                                restStatusNodeHandle.tag("node:DETERMINE_WINNER|status:OPEN"),
                                restStatusBusinessHandle.tag("node:DETERMINE_WINNER|status:OPEN")
                            ).id("ABNORMAL_NODE_REST"),
                            exceptionEnd
                        )
                    ).id("AUDIT"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle,
                                /** 【投标方】更新【中标者 中标通知：完成 】调用组件执行对应的业务 **/
                                tenderWinnerHandle.tag("node:WIN_NOTICE|status:FINISH"),tenderWinnerBusinessHandle.tag("node:WIN_NOTICE|status:FINISH"),
                                tenderWinnerStageHandle.tag("stage:CALIBRATION|status:FINISH"),tenderWinnerStageBusinessHandle.tag("stage:CALIBRATION|status:FINISH"),
                                /** 【投标方】中标者 【签约阶段 开启】调用组件执行对应的业务  **/
                                tenderWinnerStageHandle.tag("stage:SIGN|status:OPEN"),tenderWinnerStageBusinessHandle.tag("stage:SIGN|status:OPEN"),
                                /** 【投标方】更新【未中标者】
                                    【中标通知：驳回】  【未中标】 节点【开启】 状态变更为【已投标-未中标】调用组件执行对应的业务
                                    【定标阶段 完成】调用组件执行对应的业务 **/
                                FOR(findTenderUnWinner).DO(
                                    THEN(
                                        tenderUnWinnerHandle.tag("node:WIN_NOTICE|status:ABNORMAL"),
                                        tenderUnWinnerBusinessHandle.tag("node:WIN_NOTICE|status:ABNORMAL"),
                                        tenderUnWinnerStageHandle.tag("stage:CALIBRATION|status:FINISH"),
                                        tenderUnWinnerStageBusinessHandle.tag("stage:CALIBRATION|status:FINISH"),

                                        tenderUnWinnerStageHandle.tag("stage:NOT_WIN|status:OPEN"),
                                        tenderUnWinnerStageBusinessHandle.tag("stage:NOT_WIN|status:OPEN"),
                                        tenderUnWinnerHandle.tag("node:QUOTE_NOT_WIN|status:OPEN"),
                                        tenderUnWinnerBusinessHandle.tag("node:QUOTE_NOT_WIN|status:OPEN")
                                    )
                                ),
                                stageHandle.tag("stage:SIGN|status:OPEN"),stageBusinessHandle.tag("stage:SIGN|status:OPEN"),
                                statusNodeHandle.tag("node:EDIT|status:OPEN"),statusBusinessHandle.tag("node:EDIT|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("RELEASE_CALIBRATION"),
                    exceptionEnd
                )
            ).id("CALIBRATION"),
            THEN(
                SWITCH(chooseNode).to(
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:CONFIRM|status:OPEN"),statusBusinessHandle.tag("node:CONFIRM|status:OPEN"),
                                /** 投标侧 中标的投标方的 【合同确认 开启】 **/
                                tenderWinnerHandle.tag("node:CONFIRM|status:OPEN"),tenderWinnerBusinessHandle.tag("node:CONFIRM|status:OPEN")
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("EDIT"),
                    /**THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                a
                            ).id("FINISH")
                        )
                    ).id("CONFIRM"),**/
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:SIGN|status:OPEN"),statusBusinessHandle.tag("node:SIGN|status:OPEN")
                            ).id("FINISH"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle
                            ).id("ABNORMAL"),
                            THEN(
                                /** 当前节点重置为 【开启】 **/
                                statusNodeHandle,statusBusinessHandle
                            ).id("REST"),
                            THEN(
                                restStatusNodeHandle.tag("node:CONFIRM|status:WAITING"),
                                restStatusBusinessHandle.tag("node:CONFIRM|status:WAITING"),
                                restStatusNodeHandle.tag("node:EDIT|status:OPEN"),
                                restStatusBusinessHandle.tag("node:EDIT|status:OPEN"),
                                restStatusNodeHandle.tag("node:APPROVE|status:WAITING"),
                                restStatusBusinessHandle.tag("node:APPROVE|status:WAITING")
                            ).id("ABNORMAL_NODE_REST"),
                            exceptionEnd
                        )
                    ).id("APPROVE"),
                    THEN(
                        SWITCH(chooseStatus).to(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("SIGN"),
                    exceptionEnd
                )
            ).id("SIGN"),
            exceptionEnd
        );
    </chain>
    <chain name="tenderProcessNodeHandle">
        SWITCH(chooseStage).TO(
            THEN(
                SWITCH(chooseNode).TO(
                    THEN(
                       SWITCH(chooseStatus).TO(
                           THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:QUOTE|status:OPEN"),statusBusinessHandle.tag("node:QUOTE|status:OPEN")
                           ).id("FINISH")
                        )
                    ).id("REGISTER"),
                    THEN(
                        SWITCH(chooseStatus).TO(
                           THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle,
                                stageHandle.tag("stage:CALIBRATION|status:OPEN"),stageBusinessHandle.tag("stage:CALIBRATION|status:OPEN"),
                                statusNodeHandle.tag("node:WIN_NOTICE|status:OPEN"),statusBusinessHandle.tag("node:WIN_NOTICE|status:OPEN")
                            ).id("FINISH")
                        )
                    ).id("QUOTE"),
                    exceptionEnd
                )
            ).id("QUOTE"),
            /**THEN(
                a
            ).id("calibration"),**/
            THEN(
                SWITCH(chooseNode).TO(
                    THEN(
                        SWITCH(chooseStatus).TO(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                statusNodeHandle.tag("node:SIGN|status:OPEN"),statusBusinessHandle.tag("node:SIGN|status:OPEN"),
                                /** 招标方 【合同确认 完成】 执行对应业务; 【审批 开启】执行对应业务 **/
                                bidderStatusNodeHandle.tag("node:CONFIRM|status:FINISH"),bidderStatusBusinessHandle.tag("node:CONFIRM|status:FINISH"),
                                bidderStatusNodeHandle.tag("node:APPROVE|status:OPEN"),bidderStatusBusinessHandle.tag("node:APPROVE|status:OPEN")
                            ).id("FINISH"),
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                /** 招标方 【合同确认 驳回】执行对应业务;  【合同编制 开启】执行对应业务; **/
                                bidderStatusNodeHandle.tag("node:CONFIRM|status:ABNORMAL"),bidderStatusBusinessHandle.tag("node:CONFIRM|status:ABNORMAL"),
                                bidderStatusNodeHandle.tag("node:EDIT|status:OPEN"),bidderStatusBusinessHandle.tag("node:EDIT|status:OPEN")
                            ).id("ABNORMAL"),
                            exceptionEnd
                        )
                    ).id("CONFIRM"),
                    THEN(
                        SWITCH(chooseStatus).TO(
                            THEN(
                                statusNodeHandle,statusBusinessHandle,
                                stageHandle,stageBusinessHandle
                            ).id("FINISH"),
                            exceptionEnd
                        )
                    ).id("SIGN"),
                    exceptionEnd
                )
            ).id("SIGN"),
            exceptionEnd
        );
    </chain>


    <chain name="chain3">
        FOR(forCmp).DO(THEN(a,b));
    </chain>

    <chain name="chain1">
        THEN(
            a,
            SWITCH(d).to(
                b,
                THEN(
                    c,
                    WHEN(e,f)
                ).id("when1")
            )
        );
    </chain>
    <chain name="chain2">
        THEN(
            a,
            SWITCH(d).to(
                b.tag("boy"),
                THEN(
                    c,
                    WHEN(e,f)
                ).id("when1")
            )
        );
    </chain>
</flow>